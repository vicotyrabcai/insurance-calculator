<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿é™©åˆ©ç›Šè®¡ç®—å™¨ï¼ˆçœŸå®æ•°æ®ç‰ˆï¼‰</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script>window.injectInfo = { env: "PROD" };</script>
    <script>window.publicPath = "https://gw.alipayobjects.com/render/p/yuyan/180023180006000310/";</script>
    <script defer src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            margin: 0;
            padding: 16px;
            border-radius: 8px;
        }
        .premium-button {
            transition: all 0.2s ease;
        }
        .premium-button:hover {
            transform: scale(1.05);
        }
        .premium-button.active {
            background-color: #3b82f6;
            color: white;
        }
        .payment-button {
            transition: all 0.2s ease;
        }
        .payment-button:hover {
            transform: scale(1.05);
        }
        .payment-button.active {
            background-color: #10b981;
            color: white;
        }
        .gender-button {
            transition: all 0.2s ease;
        }
        .gender-button:hover {
            transform: scale(1.05);
        }
        .gender-button.active {
            background-color: #8b5cf6;
            color: white;
        }
        .result-table {
            font-size: 12px;
            overflow-x: auto;
            max-width: 100%;
            display: block;
            white-space: nowrap;
        }
        .result-table th,
        .result-table td {
            padding: 8px 12px;
            white-space: nowrap;
            min-width: 60px;
            font-size: 12px;
            text-align: right;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        .result-table th:first-child,
        .result-table td:first-child {
            text-align: center;
            min-width: 40px;
        }
        .result-table th:nth-child(2),
        .result-table td:nth-child(2) {
            text-align: center;
            min-width: 40px;
        }
        input[type="range"] {
            --track-color: rgba(0,0,0,0.1);
        }
        input[type="range"]::-webkit-slider-thumb {
            background-color: #3b82f6;
        }
        input[type="range"]::-moz-range-thumb {
            background-color: #3b82f6;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .data-source {
            color: #22c55e;
            margin-top: 10px;
            font-size: 12px;
            text-align: right;
        }
        /* åˆ†äº«æ¨¡æ€æ¡†æ ·å¼ */
        #shareModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .share-modal-content {
            background: white;
            border-radius: 8px;
            padding: 20px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .share-url-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-right: none;
            border-radius: 4px 0 0 4px;
            font-size: 14px;
        }
        .copy-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
        .copy-btn:hover {
            background: #2563eb;
        }
        .qrcode-container {
            width: 150px;
            height: 150px;
            background: #f8f9fa;
            border: 2px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            border-radius: 4px;
        }
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .modal-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .modal-btn.primary {
            background: #10b981;
            color: white;
        }
        .modal-btn.secondary {
            background: #6b7280;
            color: white;
        }
        .modal-btn:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div id="container" class="container bg-white rounded-lg shadow-lg w-full" style="margin: 0px !important;">
        <div class="p-4">
            <h1 class="text-xl font-bold text-center mb-6 text-gray-800">ä¿é™©åˆ©ç›Šè®¡ç®—å™¨ï¼ˆçœŸå®æ•°æ®ç‰ˆï¼‰</h1>
            
            <!-- æ€§åˆ«é€‰æ‹© -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    <span class="material-icons text-sm mr-1">wc</span>æ€§åˆ«
                </label>
                <div class="grid grid-cols-2 gap-2">
                    <label class="gender-button flex items-center justify-center py-2 px-3 rounded-lg border border-gray-300 text-sm font-medium transition-all cursor-pointer" data-gender="male" data-testid="gender-male">
                        <input type="radio" name="gender" value="male" class="hidden">
                        <span class="material-icons text-sm mr-1">man</span>ç”·
                    </label>
                    <label class="gender-button flex items-center justify-center py-2 px-3 rounded-lg border border-gray-300 text-sm font-medium transition-all cursor-pointer active" data-gender="female" data-testid="gender-female">
                        <input type="radio" name="gender" value="female" class="hidden" checked>
                        <span class="material-icons text-sm mr-1">woman</span>å¥³
                    </label>
                </div>
            </div>

            <!-- æŠ•ä¿å¹´é¾„ -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    <span class="material-icons text-sm mr-1">person</span>æŠ•ä¿å¹´é¾„
                </label>
                <div class="flex items-center space-x-2">
                    <input type="range" id="age" min="0" max="80" value="50" class="flex-1" data-testid="age-slider">
                    <span id="ageValue" class="text-sm font-medium w-12 text-center">50å²</span>
                </div>
            </div>

            <!-- äº¤è´¹æœŸé—´ -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    <span class="material-icons text-sm mr-1">schedule</span>äº¤è´¹æœŸé—´
                </label>
                <div class="grid grid-cols-4 gap-2">
                    <button class="payment-button py-2 px-3 rounded-lg border border-gray-300 text-sm font-medium transition-all" data-payment="3" data-testid="payment-3">
                        3å¹´
                    </button>
                    <button class="payment-button py-2 px-3 rounded-lg border border-gray-300 text-sm font-medium transition-all" data-payment="4" data-testid="payment-4">
                        4å¹´
                    </button>
                    <button class="payment-button py-2 px-3 rounded-lg border border-gray-300 text-sm font-medium transition-all active" data-payment="5" data-testid="payment-5">
                        5å¹´
                    </button>
                    <button class="payment-button py-2 px-3 rounded-lg border border-gray-300 text-sm font-medium transition-all" data-payment="10" data-testid="payment-10">
                        10å¹´
                    </button>
                </div>
            </div>

            <!-- å¹´äº¤ä¿è´¹ -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    <span class="material-icons text-sm mr-1">payments</span>å¹´äº¤ä¿è´¹
                </label>
                
                <!-- å¿«é€Ÿé€‰æ‹©æŒ‰é’® -->
                <div class="grid grid-cols-4 gap-2 mb-3">
                    <button class="premium-button py-2 px-3 rounded-lg border border-gray-300 text-sm font-medium transition-all" data-premium="10000" data-testid="premium-10000">
                        1ä¸‡å…ƒ
                    </button>
                    <button class="premium-button py-2 px-3 rounded-lg border border-gray-300 text-sm font-medium transition-all" data-premium="50000" data-testid="premium-50000">
                        5ä¸‡å…ƒ
                    </button>
                    <button class="premium-button py-2 px-3 rounded-lg border border-gray-300 text-sm font-medium transition-all active" data-premium="100000" data-testid="premium-100000">
                        10ä¸‡å…ƒ
                    </button>
                    <button class="premium-button py-2 px-3 rounded-lg border border-gray-300 text-sm font-medium transition-all" data-premium="1000000" data-testid="premium-1000000">
                        100ä¸‡å…ƒ
                    </button>
                </div>
                
                <!-- è‡ªå®šä¹‰è¾“å…¥æ¡† -->
                <div class="flex items-center space-x-2">
                    <input type="number" id="customPremium" placeholder="è‡ªå®šä¹‰å¹´äº¤ä¿è´¹" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" data-testid="custom-premium">
                    <span class="text-sm text-gray-600">å…ƒ</span>
                </div>
            </div>

            <!-- è®¡ç®—æŒ‰é’® -->
            <div class="mb-6">
                <button id="calculateBtn" class="w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors" data-testid="calculate-btn">
                    <span class="material-icons text-sm mr-1">calculate</span>è®¡ç®—åˆ©ç›Š
                </button>
            </div>

            <!-- åŠ è½½åŠ¨ç”» -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p class="text-gray-600 mt-2">æ­£åœ¨åŠ è½½çœŸå®æ•°æ®ï¼Œè¯·å‹¿åˆ·æ–°...</p>
            </div>

            <!-- è®¡ç®—ç»“æœ -->
            <div id="resultSection" class="hidden">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="text-lg font-bold text-gray-800">å¹´åº¦åˆ©ç›Šæ˜ç»†</h2>
                    <span class="text-sm text-gray-600 bg-gray-100 px-2 py-1 rounded">å•ä½ï¼šå…ƒ</span>
                </div>
                
                <!-- åŠŸèƒ½æŒ‰é’®åŒºåŸŸ -->
                <div class="mb-3 flex gap-2">
                    <button id="exportBtn" class="flex-1 bg-green-500 text-white py-2 px-3 rounded-lg text-sm font-medium hover:bg-green-600 transition-colors">
                        <span class="material-icons text-sm mr-1">download</span>å¯¼å‡ºExcel
                    </button>
                    <button id="shareBtn" class="flex-1 bg-green-600 text-white py-2 px-3 rounded-lg text-sm font-medium hover:bg-green-700 transition-colors">
                        <span class="material-icons text-sm mr-1">share</span>å¾®ä¿¡åˆ†äº«
                    </button>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="result-table w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="border border-gray-300 text-center" style="min-width: 40px;">å¹´åº¦</th>
                                <th class="border border-gray-300 text-center" style="min-width: 40px;">å¹´é¾„</th>
                                <th class="border border-gray-300 text-right" style="min-width: 80px;">å¹´åº¦ä¿è´¹</th>
                                <th class="border border-gray-300 text-right" style="min-width: 80px;">ç´¯è®¡ä¿è´¹</th>
                                <th class="border border-gray-300 text-right" style="min-width: 80px;">ç°é‡‘ä»·å€¼</th>
                                <th class="border border-gray-300 text-right" style="min-width: 80px;">ç´¯è®¡çº¢åˆ©</th>
                                <th class="border border-gray-300 text-right" style="min-width: 80px;">ç”Ÿå­˜æ€»åˆ©ç›Š</th>
                                <th class="border border-gray-300 text-right" style="min-width: 80px;">å½“å¹´æ”¶ç›Šç‡</th>
                            </tr>
                        </thead>
                        <tbody id="resultBody">
                        </tbody>
                    </table>
                </div>
                <div class="data-source">âœ… æ•°æ®æ¥æºï¼šå…¨å¹´é¾„æ®µåˆå¹¶æ•°æ®.jsonï¼ˆçœŸå®æ•°æ®ï¼Œæ— é¢„æµ‹ï¼‰</div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡ï¼šå­˜å‚¨çœŸå®JSONæ•°æ®
        let insuranceDatabase = null;

        // 1. åŠ è½½çœŸå®JSONæ•°æ®
        async function loadInsuranceData() {
            try {
                console.log("å¼€å§‹åŠ è½½çœŸå®æ•°æ®...");
                const response = await fetch('ä¿é™©åˆ©ç›Šè®¡ç®—å™¨_files/å…¨å¹´é¾„æ®µåˆå¹¶æ•°æ®.json');
                
                if (!response.ok) {
                    throw new Error(`æ•°æ®æ–‡ä»¶æœªæ‰¾åˆ°ï¼è¯·æ£€æŸ¥"ä¿é™©åˆ©ç›Šè®¡ç®—å™¨_files"æ–‡ä»¶å¤¹æ˜¯å¦ä¸HTMLåŒçº§ï¼ŒçŠ¶æ€ç : ${response.status}`);
                }
                
                insuranceDatabase = await response.json();
                console.log("âœ… çœŸå®æ•°æ®åŠ è½½æˆåŠŸï¼åŒ…å«å¹´é¾„èŠ‚ç‚¹ï¼š", Object.keys(insuranceDatabase).join(", "));
                
                // éªŒè¯æ ¸å¿ƒæ•°æ®ï¼ˆ50å²å¥³æ€§ï¼‰
                if (!insuranceDatabase["50"]) {
                    throw new Error("âŒâŒ JSONä¸­æœªæ‰¾åˆ°50å²æ•°æ®ï¼Œè¯·æ£€æŸ¥æ•°æ®æ–‡ä»¶ç»“æ„");
                }
                if (!insuranceDatabase["50"].benefit_data) {
                    throw new Error("âŒâŒ JSONä¸­50å²æ•°æ®ç¼ºå°‘benefit_dataå­—æ®µ");
                }
                
                return insuranceDatabase;
            } catch (error) {
                console.error("âŒâŒ æ•°æ®åŠ è½½å¤±è´¥ï¼š", error.message);
                alert("çœŸå®æ•°æ®åŠ è½½å¤±è´¥ï¼é”™è¯¯ï¼š" + error.message + "\nè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ£€æŸ¥ï¼š1. ç¡®è®¤JSONæ–‡ä»¶è·¯å¾„æ­£ç¡® 2. éªŒè¯JSONæ ¼å¼æ— è¯¯");
                return null;
            }
        }

        // 2. ä¿é™©æ•°æ®é¢„æµ‹å™¨
        class InsurancePredictor {
            constructor() {
                this.realData = null;
            }

            // å¼ºåˆ¶ä½¿ç”¨çœŸå®æ•°æ®è®¡ç®—
            calculateFromRealData(age, paymentYears, annualPremium, totalYears = 30) {
                // æ£€æŸ¥æ•°æ®æ˜¯å¦åŠ è½½å®Œæˆ
                if (!insuranceDatabase) {
                    alert("çœŸå®æ•°æ®æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•");
                    return [];
                }

                // æŸ¥æ‰¾å½“å‰å¹´é¾„çš„çœŸå®æ•°æ®
                const ageKey = age.toString();
                if (!insuranceDatabase[ageKey]) {
                    alert(`æœªæ‰¾åˆ°${age}å²çš„çœŸå®æ•°æ®ï¼å½“å‰æ”¯æŒå¹´é¾„ï¼š${Object.keys(insuranceDatabase).join(", ")}`);
                    return [];
                }
                const ageData = insuranceDatabase[ageKey];

                // è®¡ç®—ä¿è´¹æ¯”ä¾‹ï¼ˆåŸºäºJSONä¸­çš„åŸºå‡†ä¿è´¹ï¼š30000å…ƒï¼‰
                const basePremium = ageData.å¹´äº¤ä¿è´¹ || 30000;
                const premiumRatio = annualPremium / basePremium;
                console.log(`ğŸ“ŠğŸ“Š ä¿è´¹æ¯”ä¾‹è®¡ç®—ï¼šè¾“å…¥ä¿è´¹${annualPremium}å…ƒ / åŸºå‡†ä¿è´¹${basePremium}å…ƒ = ${premiumRatio.toFixed(4)}`);

                // æå–å¹´åº¦çœŸå®æ•°æ®å¹¶æ•´ç†
                const results = [];
                let accumulatedPremium = 0;

                for (let year = 1; year <= totalYears; year++) {
                    const currentAge = age + year - 1;
                    // è®¡ç®—ç´¯è®¡ä¿è´¹ï¼ˆä»…äº¤è´¹æœŸå†…ç´¯åŠ ï¼‰
                    const yearPremium = year <= paymentYears ? annualPremium : 0;
                    accumulatedPremium += yearPremium;

                    // ä»JSONä¸­æ‰¾åˆ°å¯¹åº”å¹´åº¦çš„æ•°æ®
                    const realYearData = ageData.benefit_data.find(item => item.ä¿å•å¹´åº¦ === year);
                    if (!realYearData) {
                        console.log(`âš ï¸ ç¬¬${year}å¹´æ•°æ®ç¼ºå¤±ï¼Œè·³è¿‡è¯¥å¹´åº¦`);
                        continue;
                    }

                    // æŒ‰ä¿è´¹æ¯”ä¾‹è°ƒæ•´æ•°æ®
                    const cashValue = Math.round(realYearData.ç°é‡‘ä»·å€¼ * premiumRatio);
                    const annualBonus = Math.round(realYearData.å¹´åº¦çº¢åˆ© * premiumRatio);
                    const accumulatedBonus = Math.round(realYearData.ç´¯ç§¯çº¢åˆ© * premiumRatio);
                    const totalBenefit = Math.round(realYearData.ç”Ÿå­˜æ€»åˆ©ç›Š * premiumRatio);

                    // ä¿®æ”¹1ï¼šå‰5å¹´æ”¶ç›Šç‡æ˜¾ç¤ºä¸º"-"
                    let yieldRate = "-";
                    if (year > 5) { // ç¬¬6å¹´å¼€å§‹è®¡ç®—æ”¶ç›Šç‡
                        if (year > 1 && results.length >= year - 1) {
                            const prevResult = results[year - 2];
                            if (prevResult && prevResult.totalBenefit > 0) {
                                const profit = totalBenefit - prevResult.totalBenefit - yearPremium;
                                yieldRate = ((profit / prevResult.totalBenefit) * 100).toFixed(2) + "%";
                            }
                        }
                    }

                    // æ•´ç†ç»“æœ
                    results.push({
                        year: year,
                        age: currentAge,
                        yearPremium: Math.round(yearPremium),
                        accumulatedPremium: Math.round(accumulatedPremium),
                        cashValue: cashValue,
                        annualBonus: annualBonus, // ä¿ç•™æ•°æ®ä½†ä¸æ˜¾ç¤º
                        accumulatedBonus: accumulatedBonus,
                        totalBenefit: totalBenefit,
                        yieldRate: yieldRate
                    });
                }

                return results;
            }
        }

        // 3. DOMå…ƒç´ è·å–ä¸åˆå§‹åŒ–
        const ageSlider = document.getElementById('age');
        const ageValue = document.getElementById('ageValue');
        const genderButtons = document.querySelectorAll('.gender-button');
        const paymentButtons = document.querySelectorAll('.payment-button');
        const premiumButtons = document.querySelectorAll('.premium-button');
        const customPremium = document.getElementById('customPremium');
        const calculateBtn = document.getElementById('calculateBtn');
        const resultSection = document.getElementById('resultSection');
        const resultBody = document.getElementById('resultBody');
        const loading = document.getElementById('loading');
        const exportBtn = document.getElementById('exportBtn');
        const shareBtn = document.getElementById('shareBtn');

        // å½“å‰é€‰æ‹©çš„å‚æ•°
        let currentAge = parseInt(ageSlider.value);
        let currentGender = 'female';
        let currentPaymentYears = 5;
        let currentAnnualPremium = 100000;

        // åˆå§‹åŒ–é¢„æµ‹å™¨
        const predictor = new InsurancePredictor();

        // 4. äº‹ä»¶ç›‘å¬å™¨ï¼šå‚æ•°é€‰æ‹©
        // å¹´é¾„æ»‘å—
        ageSlider.addEventListener('input', function() {
            currentAge = parseInt(this.value);
            ageValue.textContent = currentAge + 'å²';
        });

        // æ€§åˆ«é€‰æ‹©
        genderButtons.forEach(button => {
            button.addEventListener('click', function() {
                genderButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                currentGender = this.dataset.gender;
            });
        });

        // äº¤è´¹æœŸé—´é€‰æ‹©
        paymentButtons.forEach(button => {
            button.addEventListener('click', function() {
                paymentButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                currentPaymentYears = parseInt(this.dataset.payment);
            });
        });

        // ä¿è´¹é€‰æ‹©
        premiumButtons.forEach(button => {
            button.addEventListener('click', function() {
                premiumButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                currentAnnualPremium = parseInt(this.dataset.premium);
                customPremium.value = '';
            });
        });

        // è‡ªå®šä¹‰ä¿è´¹è¾“å…¥
        customPremium.addEventListener('input', function() {
            if (this.value && !isNaN(this.value) && this.value > 0) {
                premiumButtons.forEach(btn => btn.classList.remove('active'));
                currentAnnualPremium = parseInt(this.value);
            }
        });

        // 5. è®¡ç®—æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        calculateBtn.addEventListener('click', async function() {
            loading.style.display = 'block';
            resultSection.classList.add('hidden');
            resultBody.innerHTML = '';

            if (!insuranceDatabase) {
                insuranceDatabase = await loadInsuranceData();
                if (!insuranceDatabase) {
                    loading.style.display = 'none';
                    return;
                }
            }

            setTimeout(() => {
                const results = predictor.calculateFromRealData(
                    currentAge,
                    currentPaymentYears,
                    currentAnnualPremium,
                    30
                );

                if (results.length > 0) {
                    displayResults(results);
                } else {
                    resultBody.innerHTML = '<tr><td colspan="8" class="text-center text-red-500 py-4">æœªæ‰¾åˆ°å¯¹åº”å¹´åº¦çš„çœŸå®æ•°æ®</td></tr>';
                }

                loading.style.display = 'none';
                resultSection.classList.remove('hidden');
            }, 500);
        });

        // 6. æ˜¾ç¤ºç»“æœåˆ°è¡¨æ ¼
        function displayResults(results) {
            resultBody.innerHTML = '';
            results.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-gray-300 text-center">${item.year}</td>
                    <td class="border border-gray-300 text-center">${item.age}</td>
                    <td class="border border-gray-300 text-right">${item.yearPremium.toLocaleString()}</td>
                    <td class="border border-gray-300 text-right">${item.accumulatedPremium.toLocaleString()}</td>
                    <td class="border border-gray-300 text-right">${item.cashValue.toLocaleString()}</td>
                    <td class="border border-gray-300 text-right">${item.accumulatedBonus.toLocaleString()}</td>
                    <td class="border border-gray-300 text-right">${item.totalBenefit.toLocaleString()}</td>
                    <td class="border border-gray-300 text-right">${item.yieldRate}</td>
                `;
                resultBody.appendChild(row);
            });
        }

        // 7. åˆ†äº«åŠŸèƒ½
        function generateShareableLink() {
            const params = new URLSearchParams({
                age: currentAge,
                gender: currentGender,
                paymentYears: currentPaymentYears,
                annualPremium: currentAnnualPremium
            });
            
            const currentUrl = window.location.href.split('?')[0];
            const shareUrl = `${currentUrl}?${params.toString()}`;
            
            showShareModal(shareUrl);
        }

        function showShareModal(shareUrl) {
            const modalHtml = `
                <div id="shareModal">
                    <div class="share-modal-content">
                        <h3 style="font-size: 18px; font-weight: bold; margin-bottom: 15px; text-align: center;">åˆ†äº«ä¿é™©è®¡åˆ’ä¹¦</h3>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; font-size: 14px; margin-bottom: 5px; font-weight: 500;">åˆ†äº«é“¾æ¥ï¼š</label>
                            <div style="display: flex;">
                                <input type="text" id="shareUrl" value="${shareUrl}" class="share-url-input" readonly>
                                <button onclick="copyShareUrl()" class="copy-btn">å¤åˆ¶</button>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin: 20px 0;">
                            <div class="qrcode-container">
                                <div style="text-align: center;">
                                    <div style="font-size: 48px;">ğŸ“±</div>
                                    <div style="font-size: 10px; margin-top: 5px;">æ‰«æäºŒç»´ç </div>
                                    <div style="font-size: 8px; color: #666;">${shareUrl.substring(0, 20)}...</div>
                                </div>
                            </div>
                            <p style="font-size: 12px; color: #666;">å¾®ä¿¡æ‰«ä¸€æ‰«æ‰“å¼€</p>
                        </div>
                        
                        <div class="modal-buttons">
                            <button onclick="shareToWechat()" class="modal-btn primary">å¾®ä¿¡åˆ†äº«</button>
                            <button onclick="closeShareModal()" class="modal-btn secondary">å…³é—­</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        function copyShareUrl() {
            const shareUrlInput = document.getElementById('shareUrl');
            shareUrlInput.select();
            document.execCommand('copy');
            alert('âœ… é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
        }

        function shareToWechat() {
            alert('ğŸ“± è¯·å°†å¤åˆ¶çš„é“¾æ¥å‘é€åˆ°å¾®ä¿¡èŠå¤©çª—å£');
        }

        function closeShareModal() {
            const modal = document.getElementById('shareModal');
            if (modal) modal.remove();
        }

        // åˆ†äº«æŒ‰é’®äº‹ä»¶
        shareBtn.addEventListener('click', function() {
            generateShareableLink();
        });

        // 8. å¯¼å‡ºåŠŸèƒ½
        exportBtn.addEventListener('click', function() {
            alert('å¯¼å‡ºExceléœ€é›†æˆSheetJSåº“ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£æ·»åŠ åŠŸèƒ½');
        });

        // 9. URLå‚æ•°è§£æåŠŸèƒ½
        function parseUrlParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            
            if (urlParams.has('age')) {
                currentAge = parseInt(urlParams.get('age')) || 50;
                currentGender = urlParams.get('gender') || 'female';
                currentPaymentYears = parseInt(urlParams.get('paymentYears')) || 5;
                currentAnnualPremium = parseInt(urlParams.get('annualPremium')) || 100000;
                
                document.getElementById('age').value = currentAge;
                document.getElementById('ageValue').textContent = currentAge + 'å²';
                
                // è®¾ç½®é€‰ä¸­çŠ¶æ€
                setActiveButton('[data-gender="' + currentGender + '"]', 'gender');
                setActiveButton('[data-payment="' + currentPaymentYears + '"]', 'payment');
                setActiveButton('[data-premium="' + currentAnnualPremium + '"]', 'premium');
                
                // è‡ªåŠ¨è®¡ç®—
                setTimeout(() => {
                    calculateBenefits();
                }, 1000);
            }
        }

        function setActiveButton(selector, type) {
            const buttons = document.querySelectorAll('.' + type + '-button');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            const targetBtn = document.querySelector(selector);
            if (targetBtn) targetBtn.classList.add('active');
        }

        // 10. é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            console.log("é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹é¢„åŠ è½½çœŸå®æ•°æ®...");
            insuranceDatabase = await loadInsuranceData();
            parseUrlParameters(); // è§£æURLå‚æ•°
        });

        // 11. è¾…åŠ©å‡½æ•°ï¼šè®¡ç®—åˆ©ç›Š
        async function calculateBenefits() {
            loading.style.display = 'block';
            resultSection.classList.add('hidden');
            resultBody.innerHTML = '';

            if (!insuranceDatabase) {
                insuranceDatabase = await loadInsuranceData();
                if (!insuranceDatabase) {
                    loading.style.display = 'none';
                    return;
                }
            }

            setTimeout(() => {
                const results = predictor.calculateFromRealData(
                    currentAge, 
                    currentPaymentYears, 
                    currentAnnualPremium
                );
                
                if (results.length > 0) {
                    displayResults(results);
                } else {
                    resultBody.innerHTML = '<tr><td colspan="8" class="text-center text-red-500 py-4">æœªæ‰¾åˆ°å¯¹åº”å¹´åº¦çš„çœŸå®æ•°æ®</td></tr>';
                }
                
                loading.style.display = 'none';
                resultSection.classList.remove('hidden');
            }, 500);
        }
    </script>
</body>
</html>