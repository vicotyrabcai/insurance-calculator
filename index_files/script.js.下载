document.addEventListener('DOMContentLoaded',function(){let age=30;let paymentPeriod=5;let annualPremium=100000;let gender='female';const ageSlider=document.getElementById('age');const ageValue=document.getElementById('ageValue');const customPremiumInput=document.getElementById('customPremium');const calculateBtn=document.getElementById('calculateBtn');const resultSection=document.getElementById('resultSection');const resultBody=document.getElementById('resultBody');const exportBtn=document.getElementById('exportBtn');const shareBtn=document.getElementById('shareBtn');let currentResults=[];ageSlider.addEventListener('input',function(){age=parseInt(this.value);ageValue.textContent=age+'å²';});customPremiumInput.addEventListener('input',function(){const value=parseFloat(this.value);if(!isNaN(value)&&value>0){annualPremium=value;updatePremiumButtons();}});function updatePremiumButtons(){document.querySelectorAll('.premium-button').forEach(btn=>{btn.classList.remove('active');});}
document.querySelectorAll('.premium-button').forEach(button=>{button.addEventListener('click',function(){const premium=parseInt(this.dataset.premium);annualPremium=premium;customPremiumInput.value='';document.querySelectorAll('.premium-button').forEach(btn=>{btn.classList.remove('active');});this.classList.add('active');});});document.querySelectorAll('.payment-button').forEach(button=>{button.addEventListener('click',function(){paymentPeriod=parseInt(this.dataset.payment);document.querySelectorAll('.payment-button').forEach(btn=>{btn.classList.remove('active');});this.classList.add('active');});});document.querySelectorAll('.gender-button').forEach(button=>{button.addEventListener('click',function(){gender=this.dataset.gender;document.querySelectorAll('.gender-button').forEach(btn=>{btn.classList.remove('active');});this.classList.add('active');});});calculateBtn.addEventListener('click',calculateBenefits);exportBtn.addEventListener('click',exportToExcel);shareBtn.addEventListener('click',shareToWechat);function initializeDefaults(){document.getElementById('age').value=age;document.getElementById('ageValue').textContent=age+'å²';updatePaymentPeriodButtons(5);document.getElementById('customPremium').value='';updatePremiumButtons(100000);}
function updatePaymentPeriodButtons(period){document.querySelectorAll('.payment-button').forEach(btn=>{btn.classList.remove('active');if(parseInt(btn.dataset.payment)===period){btn.classList.add('active');}});}
function updatePremiumButtons(premium){document.querySelectorAll('.premium-button').forEach(btn=>{btn.classList.remove('active');if(parseInt(btn.dataset.premium)===premium){btn.classList.add('active');}});}
initializeDefaults();function calculateBenefits(){const results=[];let totalPremium=0;let previousSurvivalBenefit=0;let cumulativeBonus=0;for(let year=0;year<=60;year++){const currentAge=age+year;let yearlyPremium=0;if(year<paymentPeriod){yearlyPremium=annualPremium;totalPremium+=annualPremium;}
const cashValue=calculateCashValue(year,totalPremium);const yearlyBonus=calculateYearlyBonus(year,totalPremium,cashValue);cumulativeBonus+=yearlyBonus;const totalSurvivalBenefit=cashValue+cumulativeBonus;let yieldRate=0;if(year>0&&totalPremium>0){yieldRate=((totalSurvivalBenefit-previousSurvivalBenefit)/totalPremium*100);}
results.push({year:year,age:currentAge,yearlyPremium:yearlyPremium,totalPremium:totalPremium,cashValue:cashValue,cumulativeBonus:cumulativeBonus,totalSurvivalBenefit:totalSurvivalBenefit,yieldRate:yieldRate});previousSurvivalBenefit=totalSurvivalBenefit;}
currentResults=results;displayResults(results);}
function calculateCashValue(year,totalPremium){if(year===0)return 0;const genderMultiplier=gender==='male'?1.0:1.03;const ageFactor=getAgeFactor(age);let cashValueRatio=0;if(year<=paymentPeriod){if(year===1){cashValueRatio=0.08;}else if(year===2){cashValueRatio=0.25;}else if(year===3){cashValueRatio=0.45;}else if(year===4){cashValueRatio=0.65;}else{cashValueRatio=0.82;}}else if(year<=10){if(year===6){cashValueRatio=0.886;}else if(year===7){cashValueRatio=0.92;}else if(year===8){cashValueRatio=0.95;}else if(year===9){cashValueRatio=0.98;}else{cashValueRatio=1.01;}}else if(year<=20){cashValueRatio=1.01+0.03*(year-10);}else if(year<=40){cashValueRatio=1.01+0.03*10+0.02*(year-20);}else{cashValueRatio=1.01+0.03*10+0.02*20+0.01*(year-40);}
const cashValue=totalPremium*cashValueRatio*genderMultiplier*ageFactor;if(age+year>=60){return Math.round(cashValue+totalPremium*0.1);}
return Math.round(cashValue);}
function getAgeFactor(insuredAge){if(insuredAge<18)return 1.15;if(insuredAge<30)return 1.05;if(insuredAge<40)return 1.0;if(insuredAge<50)return 0.96;if(insuredAge<60)return 0.92;return 0.88;}
function calculateYearlyBonus(year,totalPremium,cashValue){if(year===0||totalPremium===0)return 0;let bonusRatio=0;const genderBonusMultiplier=gender==='male'?1.0:1.02;const ageBonusFactor=getAgeBonusFactor(age);if(year<2){bonusRatio=0;}else if(year<=5){bonusRatio=0.002+0.0005*(year-2);}else if(year<=10){if(year===6){bonusRatio=0.003;}else if(year===7){bonusRatio=0.004;}else if(year===8){bonusRatio=0.005;}else if(year===9){bonusRatio=0.006;}else{bonusRatio=0.007;}}else if(year<=20){bonusRatio=0.007+0.0003*(year-10);}else if(year<=40){bonusRatio=0.010+0.0002*(year-20);}else{bonusRatio=0.014;}
const bonus=totalPremium*bonusRatio*genderBonusMultiplier*ageBonusFactor;return Math.round(bonus);}
function getAgeBonusFactor(insuredAge){if(insuredAge<18)return 1.1;if(insuredAge<30)return 1.06;if(insuredAge<40)return 1.0;if(insuredAge<50)return 0.96;if(insuredAge<60)return 0.92;return 0.88;}
function displayResults(results){resultBody.innerHTML='';results.forEach(result=>{const row=document.createElement('tr');row.className=result.year%2===0?'bg-gray-50':'bg-white';row.innerHTML=`
                <td class="border border-gray-300 text-center" style="min-width: 25px;">${result.year}</td>
                <td class="border border-gray-300 text-center" style="min-width: 25px;">${result.age}</td>
                <td class="border border-gray-300 text-right" style="min-width: 35px;">${result.yearlyPremium.toLocaleString()}</td>
                <td class="border border-gray-300 text-right" style="min-width: 35px;">${result.totalPremium.toLocaleString()}</td>
                <td class="border border-gray-300 text-right" style="min-width: 35px;">${result.cashValue.toLocaleString()}</td>
                <td class="border border-gray-300 text-right" style="min-width: 35px;">${result.cumulativeBonus.toLocaleString()}</td>
                <td class="border border-gray-300 text-right" style="min-width: 35px;">${result.totalSurvivalBenefit.toLocaleString()}</td>
                <td class="border border-gray-300 text-right" style="min-width: 35px;">${result.yieldRate.toFixed(2)}%</td>
            `;resultBody.appendChild(row);});resultSection.classList.remove('hidden');resultSection.scrollIntoView({behavior:'smooth'});}
function exportToExcel(){if(currentResults.length===0){alert('è¯·å…ˆè®¡ç®—ä¿é™©åˆ©ç›Š');return;}
let csvContent="å¹´åº¦,å¹´é¾„,å¹´åº¦ä¿è´¹,ç´¯è®¡ä¿è´¹,ç°é‡‘ä»·å€¼,ç´¯è®¡çº¢åˆ©,ç”Ÿå­˜æ€»åˆ©ç›Š,å½“å¹´æ”¶ç›Šç‡(%)\n";currentResults.forEach(result=>{csvContent+=`${result.year},${result.age},${result.yearlyPremium},${result.totalPremium},${result.cashValue},${result.cumulativeBonus},${result.totalSurvivalBenefit},${result.yieldRate.toFixed(2)}\n`;});const blob=new Blob(['\ufeff'+csvContent],{type:'text/csv;charset=utf-8;'});const link=document.createElement('a');const url=URL.createObjectURL(blob);const genderText=gender==='male'?'ç”·':'å¥³';const fileName=`ä¿é™©åˆ©ç›Šè®¡ç®—_${genderText}_${age}å²_${paymentPeriod}å¹´äº¤_${annualPremium}å…ƒ.csv`;link.setAttribute('href',url);link.setAttribute('download',fileName);link.style.visibility='hidden';document.body.appendChild(link);link.click();document.body.removeChild(link);}
function shareToWechat(){if(currentResults.length===0){alert('è¯·å…ˆè®¡ç®—ä¿é™©åˆ©ç›Š');return;}
const genderText=gender==='male'?'ç”·':'å¥³';const totalPremium=paymentPeriod*annualPremium;const finalYear=currentResults[currentResults.length-1];const finalBenefit=finalYear.totalSurvivalBenefit;const shareText=`ğŸ“Š ä¿é™©åˆ©ç›Šè®¡ç®—ç»“æœ\n`+`ğŸ‘¤ æ€§åˆ«ï¼š${genderText}\n`+`ğŸ‚ å¹´é¾„ï¼š${age}å²\n`+`ğŸ’° å¹´äº¤ä¿è´¹ï¼š${annualPremium.toLocaleString()}å…ƒ\n`+`â° äº¤è´¹æœŸé—´ï¼š${paymentPeriod}å¹´\n`+`ğŸ’µ æ€»ä¿è´¹ï¼š${totalPremium.toLocaleString()}å…ƒ\n`+`ğŸ¯ æœŸæœ«æ€»åˆ©ç›Šï¼š${finalBenefit.toLocaleString()}å…ƒ\n`+`ğŸ“ˆ æ”¶ç›Šç‡ï¼š${((finalBenefit - totalPremium) / totalPremium * 100).toFixed(2)}%\n\n`+`ğŸ”— è¯¦ç»†è®¡ç®—ï¼š${window.location.href}`;if(navigator.share){navigator.share({title:'ä¿é™©åˆ©ç›Šè®¡ç®—ç»“æœ',text:shareText,url:window.location.href}).then(()=>{console.log('åˆ†äº«æˆåŠŸ');}).catch((error)=>{console.log('åˆ†äº«å¤±è´¥:',error);copyToClipboard(shareText);});}else{copyToClipboard(shareText);}}
function copyToClipboard(text){const textarea=document.createElement('textarea');textarea.value=text;textarea.style.position='fixed';textarea.style.opacity='0';document.body.appendChild(textarea);textarea.select();try{document.execCommand('copy');alert('åˆ†äº«å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¯ä»¥ç²˜è´´åˆ°å¾®ä¿¡åˆ†äº«');}catch(err){alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶å†…å®¹');}
document.body.removeChild(textarea);}});